' Gambas class file

Public PersonaVOtmp As PersonaVO
Public DatosPruebas As ClassDatosPruebas
Public FicheroLectura As String

Public Sub Form_Open()
  
  Me.text = ("Datos de la prueba de lectura")
  Me.Center()
  
  TextLabeltiempo.text = Str$(DatosPruebas.tiempo)
  TextLabelPalabrasLeidas.text = Str$(DatosPruebas.palabrasleidas)
  TextLabelErrores.text = Str$(DatosPruebas.errores)
  
  DatosPruebas.puntuacion = CalculoPuntuacion(DatosPruebas.palabrasleidas, DatosPruebas.errores, DatosPruebas.tiempo)
  
  TextLabelResultado.text = Str$(DatosPruebas.puntuacion)
  DatosPruebas.fecha = Now 'se guarda la fecha de la prueba
  
End

Public Sub ButtonSalir_Click()
  
  Me.Close()
  
End

Public Function CalculoPuntuacion(NumeroPalabras As Integer, NumeroErrores As Integer, tiempo As Integer) As Integer
  
  Return (NumeroPalabras - NumeroErrores) * 60 / tiempo ''puntos Palabras/minuto y con  tiempo en segundos, 
  
End

Public Sub ButtonGUARDARySalir_Click()
  
  ''TODO: ETAPA 2: guardar datos de la prueba
  Dim pruebatmp As New PruebasVO
  Dim PruebastmpDAO As New PruebasDAO
  
  pruebatmp.idpersona = PersonaVOtmp.idpersona
  pruebatmp.textolectura = File.Name(FicheroLectura)
  pruebatmp.puntuacion = DatosPruebas.puntuacion 
  pruebatmp.fecha = Now
  ''TODO: ETAPA 2 Si se ha activado la grabaci√≥n de la lectura...
  '' pruebatmp.archivosonido = ficherosonido 'si es que lo hay
  
  If PruebastmpDAO.registrar(pruebatmp) Then 
    Message.Info(("Datos de la prueba guardados correctamente"))
  Else
    Message.Error(("Se ha producido un error al guardar los datos"))
  Endif
  
  Me.Close()
  
End
