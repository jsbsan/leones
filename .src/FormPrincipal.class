' Gambas class file

Public persona As PersonaVO ''persona que proviene de la introduccion de clave
Public ManejadorPersona As New PersonaDAO
Private ManejadorPruebasTmpDato As PruebasDAO 
Private PruebasTmpDato As PruebasVO

Private ruta_trabajo As String = User.Home & "/.leones"
Private ultimoobjeto As Label

Public Sub Form_Open()
  
  ModuleComun.copiarLecturas()
  
  Me.Center
  
  'carga ficheros 
  cargaficheros()
  'datos
  Me.Title = "Leones: " & persona.nombre
  
End

Public Sub cargaficheros()
  
  Dim res As Result 'result de las consultas de lecturas realizadas
  Dim VELOCIDAD As String
  
  Dim arfile As String[]
  Dim hLabel As Label
  Dim hboxtemp As HBox
  Dim nombrefile As String
  Dim arraybto As New Variant[]
  
  arfile = Dir(ruta_trabajo, "*", gb.file)  'extraemos los ficheros
  
  hboxtemp = New HBox(ScrollViewDatosFicheros) 
  hboxtemp.h = 25
  hboxtemp.w = ScrollViewDatosFicheros.w - 10
  
  hlabel = New Label(hboxtemp) 
  hlabel.h = 15
  hlabel.expand = True
  hlabel.text = "ficheros"
  hlabel.Alignment = Align.Center
  hlabel.Border = Border.Plain
  hlabel.Background = Color.cyan
  
  hlabel = New Label(hboxtemp) 
  hlabel.h = 15
  hlabel.w = 150
  hlabel.Background = Color.cyan
  hlabel.Alignment = Align.Center
  hlabel.text = ("Puntuación")
  hlabel.Border = Border.Plain
  
  hlabel = New Label(hboxtemp) 
  hlabel.h = 15
  hlabel.w = 150
  hlabel.Background = Color.cyan
  hlabel.Alignment = Align.Center
  hlabel.text = ("Acción")
  hlabel.Border = Border.Plain
  
  For Each nombrefile In arfile.Sort(gb.Ascent)  'los mostramos ordenadamente...
    hboxtemp = New HBox(ScrollViewDatosFicheros) 
    hboxtemp.h = 25
    hboxtemp.w = ScrollViewDatosFicheros.w - 10
    
    hlabel = New Label(hboxtemp) As "GrupoFicheros"
    hlabel.h = 15
    hlabel.expand = True
    
    hlabel.text = nombrefile
    hlabel.Border = Border.Plain
    hlabel.Tooltip = ("haga doble click para seleccionar lectura")
    
    hlabel = New Label(hboxtemp)
    hlabel.h = 15
    hlabel.w = 150
    hlabel.Alignment = Align.Center
    
    hlabel.text = "0 p/m" 'dato por defecto...
    
    If persona.tipo = "Profesor" Then 
      'no pongo nada...porque es un profesor
      
    Else
      'tengo que cargar los datos de la lectura si los hubiera..
      'y si no pongo el dato por defecto
      
      ''TODO: ETAPA 2: res = ManejadorPruebasTmpDato.sql() 'buscar pruebas con maxima puntuacion, donde el alumno y la prueba lo tenemos
      ' ' If res.Count <> 0 Then 
      ' '   'hay pruebas de ese alumno...
      ' '   
      ' ' Endif
      ' 
    Endif
    VELOCIDAD = hlabel.text
    
    hlabel.Border = Border.Plain
    
    hlabel = New Label(hboxtemp) As "GrupoAccion"
    hlabel.h = 15
    hlabel.w = 150
    
    If VELOCIDAD = "0 p/m" Then 
      hlabel.text = "Leer" 'si esta hecho seria, "Repetir"
    Else
      hlabel.text = "Repetir" 'si esta hecho seria, "Repetir"
    Endif
    
    hlabel.Alignment = Align.Center
    hlabel.Border = Border.Plain
    hlabel.tag = "accion en fichero|" & ruta_trabajo & "/" & nombrefile
    
  Next  
  
End

Public Sub GrupoFicheros_DblClick()
  
  If Not IsNull(ultimoobjeto) Then 
    ultimoobjeto.Background = Color.White
    
  Endif
  
  Last.Background = Color.Cyan
  
  ultimoobjeto = Last
  
End

Public Sub GrupoAccion_DblClick()
  'iniciar prueba...
  
  FormLectura.ficheroNombreLectura = Split(Last.tag, "|")[1]
  Try FormLectura.ficheroTexto = File.Load(FormLectura.ficheroNombreLectura)
  
  If Error Then 
    Message.Info(("Se ha producido un error al intentar leer el fichero de lectura"))
  Else
    FormLectura.PersonaVOtmp = persona
    FormLectura.showmodal()  
  Endif
  
End

Public Sub ButtonConfigurar_Click()
  
  FormConfigurarTest.ShowDialog()
  
End

Public Sub ButtonEstadisticas_Click()
  
  FormEstadistica.PersonaVOtmp = persona
  FormEstadistica.ShowModal()
  
End
